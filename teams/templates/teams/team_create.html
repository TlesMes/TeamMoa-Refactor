{% extends 'base_user.html' %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/pages/teams.css' %}" />
{% endblock %}

{% block contents %}
<section class="auth-section">
  <div class="auth-card">
    <div class="auth-header">
      <h2>새 팀 만들기</h2>
      <p>팀을 생성하여 프로젝트를 시작하세요</p>
    </div>
    
    <form method="POST" action="." class="auth-form">
      {% csrf_token %}
      
      <div class="form-group">
        <label for="id_title">팀명</label>
        <div class="input-wrapper">
          <i class="ri-team-line"></i>
          {{ form.title }}
        </div>
        {% if form.title.errors %}
          <div class="field-error">
            {% for error in form.title.errors %}
              <span>{{ error }}</span>
            {% endfor %}
          </div>
        {% endif %}
      </div>

      <div class="form-group">
        <label for="id_maxuser">최대 인원수</label>
        <div class="input-wrapper">
          <i class="ri-group-line"></i>
          {{ form.maxuser }}
        </div>
        {% if form.maxuser.errors %}
          <div class="field-error">
            {% for error in form.maxuser.errors %}
              <span>{{ error }}</span>
            {% endfor %}
          </div>
        {% endif %}
      </div>

      <div class="form-group">
        <label for="id_teampasswd">팀 비밀번호</label>
        <div class="input-wrapper">
          <i class="ri-lock-line"></i>
          {{ form.teampasswd }}
        </div>
        <div class="help-text">
          <small>팀원들이 가입할 때 사용할 비밀번호입니다</small>
        </div>
        {% if form.teampasswd.errors %}
          <div class="field-error">
            {% for error in form.teampasswd.errors %}
              <span>{{ error }}</span>
            {% endfor %}
          </div>
        {% endif %}
      </div>

      <div class="form-group">
        <label for="id_introduction">팀 소개</label>
        <div class="textarea-wrapper">
          <i class="ri-file-text-line"></i>
          {{ form.introduction }}
        </div>
        <div class="help-text">
          <small>팀의 목표나 프로젝트에 대해 간단히 설명해주세요</small>
        </div>
        {% if form.introduction.errors %}
          <div class="field-error">
            {% for error in form.introduction.errors %}
              <span>{{ error }}</span>
            {% endfor %}
          </div>
        {% endif %}
      </div>

      <button type="submit" class="auth-btn">
        <i class="ri-add-circle-line"></i>
        팀 생성하기
      </button>
    </form>
    
    <div class="auth-links">
      <p>
        이미 팀이 있으신가요? 
        <a href="{% url 'teams:team_search' %}">팀 검색하기</a>
      </p>
    </div>
  </div>
</section>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.querySelector('.auth-form');
    const titleInput = document.getElementById('id_title');
    const maxuserInput = document.getElementById('id_maxuser');
    const passwordInput = document.getElementById('id_teampasswd');
    const introductionInput = document.getElementById('id_introduction');

    // 입력 시 에러 상태 제거
    [titleInput, maxuserInput, passwordInput, introductionInput].forEach(input => {
        if (input) {
            input.addEventListener('input', function() {
                if (this.value.trim()) {
                    clearFieldError(this);
                }
            });
        }
    });

    // 폼 제출 검증
    form.addEventListener('submit', function(e) {
        // 필수 필드 검증
        const isValid = validateRequiredFields([
            { input: titleInput, message: '팀명을 입력해주세요.' },
            { input: maxuserInput, message: '최대 인원수를 입력해주세요.' },
            { input: passwordInput, message: '팀 비밀번호를 입력해주세요.' },
            { input: introductionInput, message: '팀 소개를 입력해주세요.' }
        ]);

        if (!isValid) {
            e.preventDefault();
            return false;
        }

        // 최대 인원수 숫자 검증
        const maxuserValue = maxuserInput.value.trim();

        // 완전한 숫자인지 확인 (정수만)
        if (!/^\d+$/.test(maxuserValue)) {
            const wrapper = maxuserInput.closest('.input-wrapper') || maxuserInput.closest('.form-group');
            if (wrapper) {
                wrapper.classList.add('error');
            }
            showDjangoToast('최대 인원수는 숫자만 입력해주세요.', 'error');
            maxuserInput.focus();
            e.preventDefault();
            return false;
        }

        const maxuserNum = parseInt(maxuserValue, 10);

        if (maxuserNum < 1) {
            const wrapper = maxuserInput.closest('.input-wrapper') || maxuserInput.closest('.form-group');
            if (wrapper) {
                wrapper.classList.add('error');
            }
            showDjangoToast('팀 인원수는 1명 이상이어야 합니다.', 'error');
            maxuserInput.focus();
            e.preventDefault();
            return false;
        }

        if (maxuserNum > 100) {
            const wrapper = maxuserInput.closest('.input-wrapper') || maxuserInput.closest('.form-group');
            if (wrapper) {
                wrapper.classList.add('error');
            }
            showDjangoToast('팀 인원수는 100명을 초과할 수 없습니다.', 'error');
            maxuserInput.focus();
            e.preventDefault();
            return false;
        }
    });
});
</script>
{% endblock %}
