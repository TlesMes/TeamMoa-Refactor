{% extends 'base_app.html' %} {% load static %} {% block contents %}
{% comment %} Light theme styles loaded in base_app.html {% endcomment %}
<section class="mindmapsection">
  <div class="mindmap-header">
    <h1>ë§ˆì¸ë“œë§µ ëª©ë¡</h1>
    <button class="create-btn" onclick="location.href='/mindmaps/mindmap_create/{{team.id}}'">
      ë§ˆì¸ë“œë§µ ìƒì„±
    </button>
  </div>
  
  {% if mindmaps %}
  <div class="mindmap-grid">
    {% for mindmap in mindmaps %}
    <div class="mindmap-card">
      <h3 class="mindmap-title">{{ mindmap.title }}</h3>
      <div class="mindmap-actions">
        <button class="view-btn view-mindmap-btn" data-view-url="/mindmaps/mindmap_detail_page/{{ team.id }}/{{ mindmap.id }}">
          ë³´ê¸°
        </button>
        {% if request.user == team.host %}
        <button class="delete-btn delete-mindmap-btn" data-delete-url="/mindmaps/mindmap_delete/{{ team.id }}/{{ mindmap.id }}">
          ì‚­ì œ
        </button>
        {% endif %}
      </div>
    </div>
    {% endfor %}
  </div>
  {% else %}
  <div class="empty-state">
    <div class="empty-icon">ğŸ§ </div>
    <h3>ì•„ì§ ë§ˆì¸ë“œë§µì´ ì—†ìŠµë‹ˆë‹¤</h3>
    <p>íŒ€ì˜ ì²« ë²ˆì§¸ ë§ˆì¸ë“œë§µì„ ë§Œë“¤ì–´ë³´ì„¸ìš”!</p>
    <button class="empty-create-btn" onclick="location.href='/mindmaps/mindmap_create/{{team.id}}'">
      ë§ˆì¸ë“œë§µ ìƒì„±í•˜ê¸°
    </button>
  </div>
  {% endif %}
</section>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // ë§ˆì¸ë“œë§µ ë³´ê¸° ë²„íŠ¼ ì´ë²¤íŠ¸
    const viewBtns = document.querySelectorAll('.view-mindmap-btn');
    viewBtns.forEach(btn => {
        btn.addEventListener('click', function() {
            const viewUrl = this.dataset.viewUrl;
            window.location.href = viewUrl;
        });
    });

    // ë§ˆì¸ë“œë§µ ì‚­ì œ ë²„íŠ¼ ì´ë²¤íŠ¸
    const deleteBtns = document.querySelectorAll('.delete-mindmap-btn');
    deleteBtns.forEach(btn => {
        btn.addEventListener('click', function(e) {
            e.preventDefault();
            const deleteUrl = this.dataset.deleteUrl;
            showConfirmModal('ì •ë§ë¡œ ì´ ë§ˆì¸ë“œë§µì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?', () => {
                // ë™ì  POST í¼ ìƒì„±
                const form = document.createElement('form');
                form.method = 'POST';
                form.action = deleteUrl;
                form.style.display = 'none';
                
                // CSRF í† í° ì¶”ê°€ (Djangoì—ì„œ ì œê³µ)
                const csrfToken = document.querySelector('input[name="csrfmiddlewaretoken"]')?.value || 
                                  '{{ csrf_token }}';
                
                const hiddenField = document.createElement('input');
                hiddenField.type = 'hidden';
                hiddenField.name = 'csrfmiddlewaretoken';
                hiddenField.value = csrfToken;
                form.appendChild(hiddenField);
                
                document.body.appendChild(form);
                form.submit();
            });
        });
    });
});
</script>

{% endblock %}
