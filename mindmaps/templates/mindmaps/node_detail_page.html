{% extends 'base_app.html' %}
{% load static %}

{% block title %}{{ node.title }} - 노드 상세{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/pages/mindmaps/common.css' %}">
<link rel="stylesheet" href="{% static 'css/pages/mindmaps/node_detail.css' %}" />
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/pages/node_detail.js' %}"></script>
{% endblock %}

{% block contents %}
<section class="node-detail-page">
  <div class="content-card">
    <div class="node-detail-header">
      <a href="{% url 'mindmaps:mindmap_detail_page' team.id node.mindmap.id %}" class="node-detail-back-btn">
        <i class="ri-arrow-left-line"></i>
      </a>
      <div class="node-detail-header-content">
        <h2>{{ node.title }}</h2>
        <p>노드 상세 정보</p>
      </div>
      <div class="node-detail-header-actions">
        <a href="{% url 'mindmaps:node_detail_page' team.id node.id %}" class="node-detail-action-btn node-detail-refresh-btn" title="새로고침">
          <i class="ri-refresh-line"></i>
        </a>
        <a href="#" class="node-detail-action-btn node-detail-delete-btn" title="노드 삭제" id="delete-node-btn" data-delete-url="{% url 'mindmaps:mindmap_delete_node' team.id node.id %}">
          <i class="ri-delete-bin-line"></i>
        </a>
      </div>
    </div>

    <div class="node-detail-content">
      <p class="node-detail-description">{{ node.content }}</p>

      <div class="node-detail-recommend">
        <span class="node-detail-recommend-count">추천: {{ node.recommendation_count }}</span>
        <form method="POST" action="{% url 'mindmaps:node_recommend' team.id node.id %}" class="tm-inline">
          {% csrf_token %}
          <button type="submit" class="node-detail-recommend-btn">
            <i class="ri-thumb-up-line"></i>
            추천하기
          </button>
        </form>
      </div>
    </div>

    <div class="node-detail-comments-section">
      <h3 class="node-detail-comments-title">댓글</h3>
      
      <div class="node-detail-comments-list">
        {% for comment in comments %}
        <div class="node-detail-comment-item">
          <div class="node-detail-comment-header">
            <span class="node-detail-comment-author">{{ comment.user.nickname }}</span>
            <span class="node-detail-comment-date">{{ comment.commented_at|date:'Y-m-d H:i' }}</span>
          </div>
          <p class="node-detail-comment-content">{{ comment.comment }}</p>
        </div>
        {% empty %}
        <div class="node-detail-no-comments">
          <i class="ri-chat-3-line"></i>
          <p>아직 댓글이 없습니다. 첫 댓글을 작성해보세요!</p>
        </div>
        {% endfor %}
      </div>

      <form method="POST" action="{% url 'mindmaps:node_detail_page' team.id node.id %}" class="node-detail-comment-form">
        {% csrf_token %}
        <div class="form-group">
          <input type="text" name="comment" placeholder="댓글을 작성해주세요" class="node-detail-comment-input" required />
          <button type="submit" class="node-detail-submit-btn">
            <i class="ri-send-plane-line"></i>
            작성하기
          </button>
        </div>
      </form>
    </div>
  </div>
</section>

<!-- 노드 삭제를 위한 숨겨진 폼 -->
<form id="delete-node-form" method="POST" action="{% url 'mindmaps:mindmap_delete_node' team.id node.id %}" class="tm-hidden">
  {% csrf_token %}
</form>


{% endblock %}
