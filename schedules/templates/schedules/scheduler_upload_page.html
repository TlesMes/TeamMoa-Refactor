{% extends 'base_app.html' %} 
{% load static %} 

{% block contents %}
<section class="page-section schedule-upload-page">
  <div class="content-card">
    <div class="card-header">
      <a href="{% url 'schedules:scheduler_page' team.id %}" class="back-btn">
        <i class="ri-arrow-left-line"></i>
      </a>
      <h2>스케줄 업로드</h2>
      <p>나의 가능한 시간대를 선택하여 팀 스케줄에 등록하세요</p>
    </div>

    <div class="info-section">
      <div class="phase-info-section">
        <div class="phase-icon">
          <i class="ri-calendar-upload-line"></i>
        </div>
        <div class="phase-description">
          <h4>개인 스케줄 등록</h4>
          <p>가능한 시간대를 체크하면 팀원들과 함께 최적의 모임 시간을 찾을 수 있습니다.</p>
        </div>
      </div>
    </div>
    
    <form method="POST" action="." class="form-container">
      {% csrf_token %}
      
      <div class="form-group">
        <label for="week">주차 선택</label>
        <div class="input-wrapper">
          <i class="ri-calendar-2-line"></i>
          <input type="week" name="week" id="week" required>
        </div>
        <div class="help-text">
          <small>스케줄을 등록할 주차를 선택해주세요</small>
        </div>
      </div>

      <div class="schedule-grid-container">
        <h4>가능한 시간대 선택</h4>
        <p class="schedule-instruction">체크박스를 클릭하여 가능한 시간을 표시해주세요</p>
        
        <div class="schedule-grid-wrapper">
          <div class="schedule-grid">
            <!-- Time column header -->
          <div class="time-column">
            <div class="time-header">시간</div>
            {% for hour in "012345678901234567890123"|make_list %}
              <div class="time-slot">
                {% if forloop.counter0 == 0 %}12:00 AM
                {% elif forloop.counter0 < 12 %}{{ forloop.counter0|stringformat:"02d" }}:00 AM
                {% elif forloop.counter0 == 12 %}12:00 PM
                {% else %}{{ forloop.counter0|add:"-12"|stringformat:"02d" }}:00 PM
                {% endif %}
              </div>
            {% endfor %}
          </div>

          <!-- Days columns -->
          <div class="day-column">
            <div class="day-header">월요일</div>
            {% for hour in "012345678901234567890123"|make_list %}
              <div class="schedule-slot">
                <label class="checkbox-wrapper" for="id_time_{{ forloop.counter0 }}_1">
                  <input type="checkbox" 
                         name="time_{{ forloop.counter0 }}-1" 
                         id="id_time_{{ forloop.counter0 }}_1"
                         class="schedule-checkbox" />
                  <span class="checkmark">
                    <i class="ri-check-line"></i>
                  </span>
                </label>
              </div>
            {% endfor %}
          </div>

          <div class="day-column">
            <div class="day-header">화요일</div>
            {% for hour in "012345678901234567890123"|make_list %}
              <div class="schedule-slot">
                <label class="checkbox-wrapper" for="id_time_{{ forloop.counter0 }}_2">
                  <input type="checkbox" 
                         name="time_{{ forloop.counter0 }}-2" 
                         id="id_time_{{ forloop.counter0 }}_2"
                         class="schedule-checkbox" />
                  <span class="checkmark">
                    <i class="ri-check-line"></i>
                  </span>
                </label>
              </div>
            {% endfor %}
          </div>

          <div class="day-column">
            <div class="day-header">수요일</div>
            {% for hour in "012345678901234567890123"|make_list %}
              <div class="schedule-slot">
                <label class="checkbox-wrapper" for="id_time_{{ forloop.counter0 }}_3">
                  <input type="checkbox" 
                         name="time_{{ forloop.counter0 }}-3" 
                         id="id_time_{{ forloop.counter0 }}_3"
                         class="schedule-checkbox" />
                  <span class="checkmark">
                    <i class="ri-check-line"></i>
                  </span>
                </label>
              </div>
            {% endfor %}
          </div>

          <div class="day-column">
            <div class="day-header">목요일</div>
            {% for hour in "012345678901234567890123"|make_list %}
              <div class="schedule-slot">
                <label class="checkbox-wrapper" for="id_time_{{ forloop.counter0 }}_4">
                  <input type="checkbox" 
                         name="time_{{ forloop.counter0 }}-4" 
                         id="id_time_{{ forloop.counter0 }}_4"
                         class="schedule-checkbox" />
                  <span class="checkmark">
                    <i class="ri-check-line"></i>
                  </span>
                </label>
              </div>
            {% endfor %}
          </div>

          <div class="day-column">
            <div class="day-header">금요일</div>
            {% for hour in "012345678901234567890123"|make_list %}
              <div class="schedule-slot">
                <label class="checkbox-wrapper" for="id_time_{{ forloop.counter0 }}_5">
                  <input type="checkbox" 
                         name="time_{{ forloop.counter0 }}-5" 
                         id="id_time_{{ forloop.counter0 }}_5"
                         class="schedule-checkbox" />
                  <span class="checkmark">
                    <i class="ri-check-line"></i>
                  </span>
                </label>
              </div>
            {% endfor %}
          </div>

          <div class="day-column">
            <div class="day-header">토요일</div>
            {% for hour in "012345678901234567890123"|make_list %}
              <div class="schedule-slot">
                <label class="checkbox-wrapper" for="id_time_{{ forloop.counter0 }}_6">
                  <input type="checkbox" 
                         name="time_{{ forloop.counter0 }}-6" 
                         id="id_time_{{ forloop.counter0 }}_6"
                         class="schedule-checkbox" />
                  <span class="checkmark">
                    <i class="ri-check-line"></i>
                  </span>
                </label>
              </div>
            {% endfor %}
          </div>

          <div class="day-column">
            <div class="day-header">일요일</div>
            {% for hour in "012345678901234567890123"|make_list %}
              <div class="schedule-slot">
                <label class="checkbox-wrapper" for="id_time_{{ forloop.counter0 }}_7">
                  <input type="checkbox" 
                         name="time_{{ forloop.counter0 }}-7" 
                         id="id_time_{{ forloop.counter0 }}_7"
                         class="schedule-checkbox" />
                  <span class="checkmark">
                    <i class="ri-check-line"></i>
                  </span>
                </label>
              </div>
            {% endfor %}
          </div>
          </div>
        </div>

        <!-- Quick selection tools -->
        <div class="selection-tools">
          <h5>빠른 선택 도구</h5>
          <div class="tools-grid">
            <button type="button" class="tool-btn" onclick="selectAllSlots()">
              <i class="ri-check-double-line"></i>
              전체 선택
            </button>
            <button type="button" class="tool-btn" onclick="clearAllSlots()">
              <i class="ri-close-line"></i>
              전체 해제
            </button>
            <button type="button" class="tool-btn" onclick="selectWorkingHours()">
              <i class="ri-briefcase-line"></i>
              업무시간 (9-18시)
            </button>
            <button type="button" class="tool-btn" onclick="selectEveningHours()">
              <i class="ri-moon-line"></i>
              저녁시간 (18-22시)
            </button>
            <button type="button" class="tool-btn" onclick="selectWeekdays()">
              <i class="ri-calendar-check-line"></i>
              평일만
            </button>
            <button type="button" class="tool-btn" onclick="selectWeekends()">
              <i class="ri-calendar-2-line"></i>
              주말만
            </button>
          </div>
        </div>
      </div>

      <div class="form-actions">
        <button type="submit" class="create-btn">
          <i class="ri-upload-line"></i>
          스케줄 업로드
        </button>
        <a href="{% url 'schedules:scheduler_page' team.id %}" class="cancel-btn">
          <i class="ri-close-line"></i>
          취소
        </a>
      </div>
    </form>
  </div>

  {% if messages %}
    <div class="messages-container">
      {% for message in messages %}
        <div class="message message-{{ message.tags }}">
          <i class="ri-information-line"></i>
          {{ message }}
        </div>
      {% endfor %}
    </div>
  {% endif %}
</section>

<script>
// 빠른 선택 도구 JavaScript 함수들
function selectAllSlots() {
  document.querySelectorAll('.schedule-checkbox').forEach(checkbox => {
    checkbox.checked = true;
  });
}

function clearAllSlots() {
  document.querySelectorAll('.schedule-checkbox').forEach(checkbox => {
    checkbox.checked = false;
  });
}

function selectWorkingHours() {
  clearAllSlots();
  // 9시부터 18시까지 (인덱스 9-17)
  for (let hour = 9; hour <= 17; hour++) {
    for (let day = 1; day <= 7; day++) {
      const checkbox = document.getElementById(`id_time_${hour}_${day}`);
      if (checkbox) checkbox.checked = true;
    }
  }
}

function selectEveningHours() {
  clearAllSlots();
  // 18시부터 22시까지 (인덱스 18-21)
  for (let hour = 18; hour <= 21; hour++) {
    for (let day = 1; day <= 7; day++) {
      const checkbox = document.getElementById(`id_time_${hour}_${day}`);
      if (checkbox) checkbox.checked = true;
    }
  }
}

function selectWeekdays() {
  // 월요일(1)부터 금요일(5)까지
  document.querySelectorAll('.schedule-checkbox').forEach(checkbox => {
    const name = checkbox.name;
    const dayMatch = name.match(/time_\d+-(\d+)/);
    if (dayMatch) {
      const day = parseInt(dayMatch[1]);
      checkbox.checked = (day >= 1 && day <= 5);
    }
  });
}

function selectWeekends() {
  // 토요일(6), 일요일(7)
  document.querySelectorAll('.schedule-checkbox').forEach(checkbox => {
    const name = checkbox.name;
    const dayMatch = name.match(/time_\d+-(\d+)/);
    if (dayMatch) {
      const day = parseInt(dayMatch[1]);
      checkbox.checked = (day === 6 || day === 7);
    }
  });
}

// 체크박스 상태 변경 시 시각적 피드백
document.addEventListener('DOMContentLoaded', function() {
  document.querySelectorAll('.schedule-checkbox').forEach(checkbox => {
    checkbox.addEventListener('change', function() {
      const wrapper = this.closest('.checkbox-wrapper');
      if (this.checked) {
        wrapper.classList.add('checked');
      } else {
        wrapper.classList.remove('checked');
      }
    });
  });
});
</script>
{% endblock %}