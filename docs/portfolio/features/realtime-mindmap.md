# ì‹¤ì‹œê°„ ë§ˆì¸ë“œë§µ í˜‘ì—… ì‹œìŠ¤í…œ

> **WebSocket + Canvas API ê¸°ë°˜ ë‹¤ì¤‘ ì‚¬ìš©ì ì‹¤ì‹œê°„ í˜‘ì—…**
> 60-80ms ì§€ì—° ì‹œê°„ ë‚´ ë…¸ë“œ ë™ê¸°í™”, ìµœëŒ€ 20ëª… ë™ì‹œ í¸ì§‘ ì§€ì›

---

## ëª©ì°¨
- [ë¬¸ì œ ì •ì˜ ë° ë¹„ì¦ˆë‹ˆìŠ¤ ëª©í‘œ](#ë¬¸ì œ-ì •ì˜-ë°-ë¹„ì¦ˆë‹ˆìŠ¤-ëª©í‘œ)
- [ìš”êµ¬ì‚¬í•­](#ìš”êµ¬ì‚¬í•­)
- [ê¸°ìˆ  ì„ íƒ ê·¼ê±°](#ê¸°ìˆ -ì„ íƒ-ê·¼ê±°)
- [ì‹œìŠ¤í…œ ì„¤ê³„](#ì‹œìŠ¤í…œ-ì„¤ê³„)
- [í•µì‹¬ êµ¬í˜„](#í•µì‹¬-êµ¬í˜„)
- [ì„±ê³¼ ë° í•œê³„](#ì„±ê³¼-ë°-í•œê³„)
- [íŠ¸ëŸ¬ë¸”ìŠˆíŒ… ìš”ì•½](#íŠ¸ëŸ¬ë¸”ìŠˆíŒ…-ìš”ì•½)

---

## ë¬¸ì œ ì •ì˜ ë° ë¹„ì¦ˆë‹ˆìŠ¤ ëª©í‘œ

### ê¸°ì¡´ ë¬¸ì œì 

**ë¹„ì‹¤ì‹œê°„ í˜‘ì—…ì˜ í•œê³„**:
- íŒ€ì›ì´ ë§ˆì¸ë“œë§µì„ ìˆ˜ì •í•˜ë©´ ìƒˆë¡œê³ ì¹¨ í•„ìš”
- ë™ì‹œ í¸ì§‘ ì‹œ ë³€ê²½ì‚¬í•­ ì¶©ëŒë¡œ ì‘ì—… ì†ì‹¤
- ëˆ„ê°€ ì–´ë””ë¥¼ ì‘ì—… ì¤‘ì¸ì§€ íŒŒì•… ë¶ˆê°€

**ê¸°ì¡´ ë„êµ¬ì˜ ì œì•½**:
- Miro, FigJam ë“± ìœ ë£Œ ì„œë¹„ìŠ¤ ì˜ì¡´
- íŒ€ í”„ë¡œì íŠ¸ ê´€ë¦¬ ì‹œìŠ¤í…œê³¼ ë³„ë„ ìš´ì˜ (ì»¨í…ìŠ¤íŠ¸ ìŠ¤ìœ„ì¹­)

### ë¹„ì¦ˆë‹ˆìŠ¤ ëª©í‘œ

**ì •ëŸ‰ì  ëª©í‘œ**:
- ë…¸ë“œ ë™ê¸°í™” ì§€ì—° 100ms ì´ë‚´
- ë™ì‹œ í¸ì§‘ ê°€ëŠ¥ ì¸ì› 10ëª… ì´ìƒ
- ë„¤íŠ¸ì›Œí¬ ëŒ€ì—­í­ 10KB/s ì´í•˜ (3ëª… ê¸°ì¤€)

**ì •ì„±ì  ëª©í‘œ**:
- íŒ€ì› ê°„ ì•„ì´ë””ì–´ ì‹œê°í™” ë° ì¦‰ê°ì  í”¼ë“œë°±
- ë‹¨ì¼ í”Œë«í¼ ë‚´ í”„ë¡œì íŠ¸ ê´€ë¦¬ í†µí•©

---

## ìš”êµ¬ì‚¬í•­

### ê¸°ëŠ¥ ìš”êµ¬ì‚¬í•­

**ì‹¤ì‹œê°„ ë™ê¸°í™”**:
- ë…¸ë“œ ìƒì„±/ì‚­ì œ/ì´ë™ ì¦‰ì‹œ ë°˜ì˜
- ì—°ê²°ì„  ìƒì„±/ì‚­ì œ ë™ê¸°í™”
- ì‚¬ìš©ì ì»¤ì„œ ìœ„ì¹˜ ê³µìœ  (Google Docs ìŠ¤íƒ€ì¼)

**Canvas ë Œë”ë§**:
- 5400Ã—3600px ê°€ìƒ ìº”ë²„ìŠ¤ (A4 ë¹„ìœ¨ Ã— 3)
- ì¤Œ/íŒ¬ ê¸°ëŠ¥ (0.5x ~ 2.0x)
- ë“œë˜ê·¸ ì•¤ ë“œë¡­ìœ¼ë¡œ ë…¸ë“œ ì´ë™

**ê¶Œí•œ ê´€ë¦¬**:
- íŒ€ ë©¤ë²„ë§Œ ì ‘ê·¼ ê°€ëŠ¥
- WebSocket ì—°ê²° ì‹œ ì‚¬ìš©ì ì¸ì¦

### ì„±ëŠ¥ ìš”êµ¬ì‚¬í•­

**ì§€ì—°ì‹œê°„**:
- ì»¤ì„œ ë™ê¸°í™”: 100ms ì´ë‚´
- ë…¸ë“œ ì´ë™ ë™ê¸°í™”: 100ms ì´ë‚´

**ë™ì‹œ ì ‘ì†**:
- ë‹¨ì¼ ë§ˆì¸ë“œë§µë‹¹ 10-20ëª… ë™ì‹œ í¸ì§‘

**ë„¤íŠ¸ì›Œí¬ íš¨ìœ¨**:
- ë©”ì‹œì§€ í¬ê¸°: í‰ê·  50 bytes ì´í•˜
- ëŒ€ì—­í­: 3ëª… ë™ì‹œ ì‘ì—… ì‹œ 10KB/s ì´í•˜

---

## ê¸°ìˆ  ì„ íƒ ê·¼ê±°

### Canvas API vs SVG/DOM

**Canvas ì„ íƒ ì´ìœ **:
- **ì„±ëŠ¥**: ëŒ€ëŸ‰ ë…¸ë“œ(50ê°œ ì´ìƒ) ë Œë”ë§ ì‹œ DOM ëŒ€ë¹„ ìš°ìˆ˜
- **ì¤Œ/íŒ¬ íš¨ìœ¨**: DOM reflow ì—†ì´ ì¢Œí‘œ ë³€í™˜ìœ¼ë¡œ ì²˜ë¦¬
- **ë Œë”ë§ ì œì–´**: í”½ì…€ ë‹¨ìœ„ ì§ì ‘ ì œì–´ ê°€ëŠ¥

**íŠ¸ë ˆì´ë“œì˜¤í”„**:
- ì ‘ê·¼ì„± ì €í•˜ (ìŠ¤í¬ë¦° ë¦¬ë” ë¯¸ì§€ì›)
- ê°œë³„ ë…¸ë“œ ì´ë²¤íŠ¸ ìˆ˜ë™ ì²˜ë¦¬ í•„ìš” (íˆíŠ¸ í…ŒìŠ¤íŠ¸)
- SEO ë¶ˆê°€ (Canvas ì½˜í…ì¸  í¬ë¡¤ë§ ë¶ˆê°€)

**ê²°ì •**: ì‹¤ì‹œê°„ í˜‘ì—… ë„êµ¬ íŠ¹ì„±ìƒ ì„±ëŠ¥ ìš°ì„ , ì ‘ê·¼ì„±ì€ ëŒ€ì²´ UIë¡œ ë³´ì™„ ê°€ëŠ¥

---

### WebSocket vs HTTP Long Polling

**WebSocket ì„ íƒ ì´ìœ **:
- **ì–‘ë°©í–¥ ì‹¤ì‹œê°„ í†µì‹ **: ì„œë²„ â†’ í´ë¼ì´ì–¸íŠ¸ í‘¸ì‹œ ê°€ëŠ¥
- **ì˜¤ë²„í—¤ë“œ ìµœì†Œ**: HTTP í—¤ë” ì—†ìŒ (ì•½ 200 bytes â†’ 2-10 bytes)
- **ì§€ì—°ì‹œê°„ ê°ì†Œ**: ì—°ê²° ìœ ì§€ë¡œ TCP handshake ì¬ì‚¬ìš©

**íŠ¸ë ˆì´ë“œì˜¤í”„**:
- ì—°ê²° ìœ ì§€ ë¹„ìš© (ë©”ëª¨ë¦¬, íŒŒì¼ ë””ìŠ¤í¬ë¦½í„°)
- í”„ë¡ì‹œ ì„¤ì • ë³µì¡ (Nginx Upgrade í—¤ë” í•„ìš”)
- ì¬ì—°ê²° ë¡œì§ í•„ìš” (ë„¤íŠ¸ì›Œí¬ ëŠê¹€ ì‹œ)

**ê²°ì •**: 100ms ì´ë‚´ ë™ê¸°í™” ìš”êµ¬ì‚¬í•­ ë‹¬ì„± ìœ„í•´ WebSocket í•„ìˆ˜

---

### Django Channels vs Socket.IO

**Django Channels ì„ íƒ ì´ìœ **:
- **Django í†µí•©**: Auth, ORM, Admin ì¬ì‚¬ìš©
- **Channel Layer**: Redis ê¸°ë°˜ ìˆ˜í‰ í™•ì¥ ê°€ëŠ¥
- **Python ìƒíƒœê³„**: ê¸°ì¡´ ì„œë¹„ìŠ¤ ë ˆì´ì–´ ì¬ì‚¬ìš©

**íŠ¸ë ˆì´ë“œì˜¤í”„**:
- Node.js ê¸°ë°˜ Socket.IO ëŒ€ë¹„ ìƒíƒœê³„ ì‘ìŒ
- ASGI ì„œë²„ (Daphne) í•„ìš” (WSGI ë¯¸ì§€ì›)

**ê²°ì •**: Django ê¸°ë°˜ í”„ë¡œì íŠ¸ë¡œ ì¼ê´€ì„± ìœ ì§€, Redis ì¸í”„ë¼ ì´ë¯¸ êµ¬ì¶•ë¨

---

## ì‹œìŠ¤í…œ ì„¤ê³„

### ì•„í‚¤í…ì²˜ ê°œìš”

```
[í´ë¼ì´ì–¸íŠ¸ A]     [í´ë¼ì´ì–¸íŠ¸ B]     [í´ë¼ì´ì–¸íŠ¸ C]
     |                  |                  |
     â””â”€â”€â”€â”€â”€â”€â”€ WebSocket â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                |
                         [Django Channels]
                         (Daphne ASGI)
                                |
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    |                       |
              [Redis Pub/Sub]          [MySQL]
              (Channel Layer)      (ì˜ì†ì„± ì €ì¥)
```

**ë°ì´í„° íë¦„**:
1. í´ë¼ì´ì–¸íŠ¸ Aê°€ ë…¸ë“œ ì´ë™
2. WebSocketìœ¼ë¡œ ì„œë²„ ì „ì†¡
3. Django Channelsê°€ MySQLì— ì €ì¥
4. Redis Pub/Subìœ¼ë¡œ ë¸Œë¡œë“œìºìŠ¤íŠ¸
5. í´ë¼ì´ì–¸íŠ¸ B, Cê°€ ìˆ˜ì‹  â†’ í™”ë©´ ì—…ë°ì´íŠ¸

---

### WebSocket ë©”ì‹œì§€ í”„ë¡œí† ì½œ

#### ë©”ì‹œì§€ ê·œê²©

**í´ë¼ì´ì–¸íŠ¸ â†’ ì„œë²„ (ìš”ì²­)**:

ë…¸ë“œ ì´ë™:
```json
{
  "type": "node_move",
  "node_id": 123,
  "x": 100,
  "y": 200
}
```

ì»¤ì„œ ì´ë™:
```json
{
  "type": "cursor_move",
  "x": 100,
  "y": 200
}
```

**ì„œë²„ â†’ í´ë¼ì´ì–¸íŠ¸ (ë¸Œë¡œë“œìºìŠ¤íŠ¸)**:

ë…¸ë“œ ì´ë™ ì•Œë¦¼:
```json
{
  "type": "node_moved",
  "node_id": 123,
  "x": 100,
  "y": 200,
  "user_id": 42,
  "username": "í™ê¸¸ë™"
}
```

ì»¤ì„œ ì´ë™ ì•Œë¦¼:
```json
{
  "type": "cursor_moved",
  "x": 100,
  "y": 200,
  "user_id": 42,
  "username": "í™ê¸¸ë™"
}
```

ì‚¬ìš©ì ì°¸ì—¬/í‡´ì¥:
```json
{
  "type": "user_joined",
  "user_id": 42,
  "username": "í™ê¸¸ë™"
}
```

#### ì„¤ê³„ ì›ì¹™

1. **ìµœì†Œ í˜ì´ë¡œë“œ**: í•„ìˆ˜ í•„ë“œë§Œ ì „ì†¡ (í‰ê·  50 bytes)
2. **íƒ€ì… ì•ˆì „ì„±**: ì„œë²„ ì¸¡ ìŠ¤í‚¤ë§ˆ ê²€ì¦ (ì˜ëª»ëœ ë©”ì‹œì§€ ë¬´ì‹œ)
3. **í™•ì¥ì„±**: í–¥í›„ í•„ë“œ ì¶”ê°€ ì‹œ í•˜ìœ„ í˜¸í™˜ì„± ìœ ì§€
4. **ì—ëŸ¬ ì²˜ë¦¬**: íŒŒì‹± ì‹¤íŒ¨ ì‹œ í´ë¼ì´ì–¸íŠ¸ ë¡œê·¸ë§Œ ë‚¨ê¹€ (ì—°ê²° ìœ ì§€)

#### ì„œë²„/í´ë¼ì´ì–¸íŠ¸ ë¶„ì—…

**í´ë¼ì´ì–¸íŠ¸ ì±…ì„**:
- ì¢Œí‘œ ë³€í™˜ (í™”ë©´ â†’ ê°€ìƒ ìº”ë²„ìŠ¤)
- Canvas ë Œë”ë§
- ì´ë²¤íŠ¸ ìŠ¤ë¡œí‹€ë§

**ì„œë²„ ì±…ì„**:
- ê¶Œí•œ ê²€ì¦ (íŒ€ ë©¤ë²„ í™•ì¸)
- ë°ì´í„° ì˜ì†í™” (MySQL)
- ë¸Œë¡œë“œìºìŠ¤íŠ¸ (Redis Pub/Sub)

---

### ë™ì‹œì„± ë° ì¶©ëŒ í•´ê²°

#### ë©”ì‹œì§€ ìˆœì„œ ë³´ì¥

**Redis Pub/Sub FIFO**:
- êµ¬ë…ìë³„ë¡œ ë©”ì‹œì§€ ìˆœì„œ ë³´ì¥
- ë‹¨ì¼ Consumer ë‚´ `async/await` ìˆœì°¨ ì²˜ë¦¬

**ì½”ë“œ ê·¼ê±°**:
```python
# mindmaps/consumers.py
async def receive(self, text_data):
    # ë©”ì‹œì§€ëŠ” ìˆœì°¨ì ìœ¼ë¡œ ì²˜ë¦¬ë¨ (async/await)
    data = json.loads(text_data)
    if message_type == 'node_move':
        await self.handle_node_move(data)  # awaitë¡œ ìˆœì„œ ë³´ì¥
```

#### ì¶©ëŒ í•´ê²° ì „ëµ

**Last Write Wins (LWW)**:
- ë™ì¼ ë…¸ë“œë¥¼ ë™ì‹œì— ìˆ˜ì • ì‹œ ë§ˆì§€ë§‰ ë³€ê²½ë§Œ ë°˜ì˜
- DB ì—…ë°ì´íŠ¸ ì„±ê³µ ì‹œì—ë§Œ ë¸Œë¡œë“œìºìŠ¤íŠ¸

**ì„ íƒ ì´ìœ **:
- ë‹¨ìˆœì„±: CRDT ëŒ€ë¹„ êµ¬í˜„ ë³µì¡ë„ ë‚®ìŒ
- ì‹¤ìš©ì„±: ì‹¤ì œ ë™ì‹œ í¸ì§‘ ì¶©ëŒ ë¹ˆë„ ë‚®ìŒ (ê°™ì€ ë…¸ë“œë¥¼ ë™ì‹œì— ë“œë˜ê·¸í•˜ëŠ” ê²½ìš° ë“œë¬¾)
- íŠ¸ë ˆì´ë“œì˜¤í”„: ë“œë¬¼ê²Œ ë³€ê²½ ì†ì‹¤ ê°€ëŠ¥ vs êµ¬í˜„ ë‹¨ìˆœ


#### ì§€ì—°(Latency) ì²˜ë¦¬

**Optimistic UI**:
- ë¡œì»¬ ë³€ê²½ ì¦‰ì‹œ ë°˜ì˜ (ì‚¬ìš©ì ì²´ê° ì§€ì—° 0ms)
- ì„œë²„ í™•ì¸ í›„ ì‹¤íŒ¨ ì‹œ ë¡¤ë°± (ë“œë¬¼ê²Œ ë°œìƒ)

**ì¬ì—°ê²° ì „ëµ**:
- WebSocket ëŠê¹€ ê°ì§€ â†’ 5ì´ˆ í›„ ìë™ ì¬ì—°ê²°
- ì¬ì—°ê²° ì‹œ ì „ì²´ ìƒíƒœ ì¬ë™ê¸°í™” (REST APIë¡œ ë…¸ë“œ ëª©ë¡ ì¬ì¡°íšŒ)

---

## í•µì‹¬ êµ¬í˜„

### Canvas ì¢Œí‘œ ë³€í™˜

**ë¬¸ì œ**: ì¤Œ/íŒ¬ ì‹œ í™”ë©´ ì¢Œí‘œ â‰  ê°€ìƒ ìº”ë²„ìŠ¤ ì¢Œí‘œ

**í•´ê²°**:
```javascript
// í™”ë©´ ì¢Œí‘œ â†’ ê°€ìƒ ìº”ë²„ìŠ¤ ì¢Œí‘œ
function screenToCanvas(screenX, screenY) {
    const rect = canvas.getBoundingClientRect();
    const canvasX = (screenX - rect.left - viewState.offsetX) / viewState.zoom;
    const canvasY = (screenY - rect.top - viewState.offsetY) / viewState.zoom;
    return { x: canvasX, y: canvasY };
}

// ê°€ìƒ ìº”ë²„ìŠ¤ ì¢Œí‘œ â†’ í™”ë©´ ì¢Œí‘œ
function canvasToScreen(canvasX, canvasY) {
    const screenX = canvasX * viewState.zoom + viewState.offsetX;
    const screenY = canvasY * viewState.zoom + viewState.offsetY;
    return { x: screenX, y: screenY };
}
```

**ì½”ë“œ ìœ„ì¹˜**: [`static/js/pages/mindmap_detail.js`](../../../static/js/pages/mindmap_detail.js)

---

### ì»¤ì„œ ì´ë™ ìŠ¤ë¡œí‹€ë§

**ë¬¸ì œ**: ë§ˆìš°ìŠ¤ ì´ë™ ì´ë²¤íŠ¸ ì´ˆë‹¹ 60íšŒ ì´ìƒ ë°œìƒ â†’ ë„¤íŠ¸ì›Œí¬ ë¶€í•˜

**í•´ê²°**: 50ms ìŠ¤ë¡œí‹€ë§
```javascript
canvas.addEventListener('mousemove', function(e) {
    if (this.cursorThrottle) return;  // 50ms ì´ë‚´ ë¬´ì‹œ

    this.cursorThrottle = setTimeout(() => {
        const { x, y } = screenToCanvas(e.clientX, e.clientY);
        this.socket.send(JSON.stringify({
            type: 'cursor_move',
            x: x,
            y: y
        }));
        this.cursorThrottle = null;
    }, 50);
});
```

**íš¨ê³¼**: ì´ˆë‹¹ 20íšŒë¡œ ì œí•œ (1000ms / 50ms = 20)

**ì½”ë“œ ìœ„ì¹˜**: [`static/js/pages/mindmap_detail.js:270-276`](../../../static/js/pages/mindmap_detail.js#L270-L276)

---

### WebSocket Consumer

**ê¶Œí•œ ê²€ì¦**:
```python
@database_sync_to_async
def check_permissions(self):
    if self.user.is_anonymous:
        return False

    # íŒ€ ë©¤ë²„ í™•ì¸ + ë§ˆì¸ë“œë§µ ì¡´ì¬ í™•ì¸
    TeamUser.objects.get(team_id=self.team_id, user=self.user)
    Mindmap.objects.get(id=self.mindmap_id, team_id=self.team_id)
    return True
```

**ë…¸ë“œ ì´ë™ ì²˜ë¦¬**:
```python
async def handle_node_move(self, data):
    node_id = data.get('node_id')
    x = data.get('x')
    y = data.get('y')

    # 1. DB ì—…ë°ì´íŠ¸
    success = await self.update_node_position(node_id, x, y)

    # 2. ì„±ê³µ ì‹œ ë¸Œë¡œë“œìºìŠ¤íŠ¸ (ë°œì‹ ì ì œì™¸)
    if success:
        await self.channel_layer.group_send(
            self.room_group_name,
            {
                'type': 'node_moved',
                'node_id': node_id,
                'x': x,
                'y': y,
                'sender_channel': self.channel_name
            }
        )
```

**ì½”ë“œ ìœ„ì¹˜**: [`mindmaps/consumers.py`](../../../mindmaps/consumers.py)

---

## ì„±ê³¼ ë° í•œê³„

### ì‹œìŠ¤í…œ ì„±ëŠ¥ ì§€í‘œ

#### ë™ê¸°í™” ì§€ì—°ì‹œê°„ (ì‹¤ì¸¡)

**ì¸¡ì • í™˜ê²½**:
- ì¼ì‹œ: 2025ë…„ 12ì›” 8ì¼
- í™˜ê²½: í”„ë¡œë•ì…˜ (`https://teammoa.duckdns.org`, AWS EC2 t3.micro)
- ì¸¡ì • ë°©ë²•: Chrome DevTools Network íƒ­, ë™ì¼ ë¸Œë¼ìš°ì €ì—ì„œ 2ê°œ íƒ­ ë™ì‹œ ì¸¡ì •
- ì¸¡ì • ì‹œë‚˜ë¦¬ì˜¤: ë…¸ë“œ ë“œë˜ê·¸ë¡œ 7íšŒ ì—°ì† ì¸¡ì •

**ì‹¤ì¸¡ê°’**:
- **ë…¸ë“œ ì´ë™ ë™ê¸°í™”**: **í‰ê·  99ms** (ë²”ìœ„: 92~104ms)
  - êµ¬ì„±: MySQL ì €ì¥ + Redis Pub/Sub + ë„¤íŠ¸ì›Œí¬ ì™•ë³µ
  - ì¸¡ì • ë°©ë²•: ë°œì‹  íƒ­ì˜ `node_move` ì‹œê°„ - ìˆ˜ì‹  íƒ­ì˜ `node_moved` ì‹œê°„ ì°¨ì´
  - 7íšŒ ì¸¡ì •: 92ms, 93ms, 98ms, 101ms, 104ms, 103ms, 101ms

- **ì»¤ì„œ ì´ë™ ë™ê¸°í™”**: **15~99ms**
  - ìµœì†Œ: 15ms (ë„¤íŠ¸ì›Œí¬ ìƒíƒœ ì–‘í˜¸ ì‹œ, ìˆœìˆ˜ ë„¤íŠ¸ì›Œí¬ RTT)
  - í‰ê· : 99ms (ë¶€í•˜ ì‹œ)
  - ì°¸ê³ : í´ë¼ì´ì–¸íŠ¸ ì¸¡ 50ms ìŠ¤ë¡œí‹€ë§ ì ìš©ë¨

**ì¶”ì • ê·¼ê±°** (ë‚´ë¶€ êµ¬ì„± ìš”ì†Œ):
- ì„œë²„ ë‚´ë¶€ RTT: 0.036ms (ì¸¡ì •ê°’, `ping localhost`)
- JSON íŒŒì‹±: <1ms
- Django ORM ì—…ë°ì´íŠ¸: 5-10ms (MySQL, ë‹¨ì¼ UPDATE ì¿¼ë¦¬)
- Redis Pub/Sub ì „íŒŒ: 3-5ms (ë¬¸í—Œ ê¸°ë°˜)
- í´ë¼ì´ì–¸íŠ¸ â†” ì„œë²„ ë„¤íŠ¸ì›Œí¬ RTT: 15~50ms (ì‹¤ì¸¡ê°’ ê¸°ë°˜)

**ë¹„ê³ **:
- ë„¤íŠ¸ì›Œí¬ ìƒíƒœì— ë”°ë¼ ë³€ë™ (15ms ~ 100ms)
- DB ì—…ë°ì´íŠ¸ ì‹œê°„ì€ MySQL ì„±ëŠ¥ì— ë”°ë¼ ë³€ë™

#### ë„¤íŠ¸ì›Œí¬ íš¨ìœ¨

**ë©”ì‹œì§€ í¬ê¸°**:
```json
{"type":"cursor_move","x":100,"y":200}  // ì•½ 40 bytes
{"type":"node_move","node_id":1,"x":100,"y":200}  // ì•½ 50 bytes
```

**ëŒ€ì—­í­ ê³„ì‚°** (3ëª… ë™ì‹œ ì‘ì—…):
- ì»¤ì„œ ì´ë™: 20íšŒ/ì´ˆ/ì¸ Ã— 3ëª… Ã— 40 bytes = 2.4 KB/s
- ë…¸ë“œ ì´ë™: í‰ê·  2íšŒ/ì´ˆ/ì¸ Ã— 3ëª… Ã— 50 bytes = 0.3 KB/s
- **ì´ ëŒ€ì—­í­**: ì•½ 2.7 KB/s (WebSocket í”„ë ˆì„ ì˜¤ë²„í—¤ë“œ 2-10 bytes ì œì™¸)

**ë¹„ê³ **: WebSocket í”„ë ˆì„ í—¤ë”ëŠ” ë©”ì‹œì§€ë‹¹ 2-10 bytes ì¶”ê°€ë˜ë‚˜ ì´ ëŒ€ì—­í­ì— ë¯¸ì¹˜ëŠ” ì˜í–¥ì€ 10% ë¯¸ë§Œ

#### ë™ì‹œ ì ‘ì† í•œê³„

**ì´ë¡ ì  í•œê³„**:
- Redis ë‹¨ì¼ ì¸ìŠ¤í„´ìŠ¤: 10,000+ ë™ì‹œ ì—°ê²°
- Django Channels: í”„ë¡œì„¸ìŠ¤ë‹¹ ìˆ˜ì²œ ê°œ ì—°ê²°

**ì‹¤ìš©ì  í•œê³„** (ë‹¨ì¼ ë§ˆì¸ë“œë§µë‹¹):
- **ê¶Œì¥**: 10-20ëª…
- **í•œê³„ ìš”ì¸**: Redis ì„±ëŠ¥ì´ ì•„ë‹Œ ë‹¤ìŒ ìš”ì†Œë“¤
  - ë¸Œë¼ìš°ì € ë Œë”ë§ ë¶€í•˜ (20ê°œ ì»¤ì„œ ë™ì‹œ ë Œë”ë§)
  - ë„¤íŠ¸ì›Œí¬ ëŒ€ì—­í­ (ì»¤ì„œ ë©”ì‹œì§€ í­ì¦)
  - UI ê°€ë…ì„± (20ëª… ì»¤ì„œ í‘œì‹œ ì‹œ í™”ë©´ í˜¼ì¡)

**ë¹„ê³ **: íŒ€ ì „ì²´ëŠ” 100ëª… ì´ìƒ ë™ì‹œ ì ‘ì† ê°€ëŠ¥ (ì„œë¡œ ë‹¤ë¥¸ ë§ˆì¸ë“œë§µ ì‚¬ìš© ì‹œ)

---

### ê¸°ìˆ ì  í•œê³„ì 

**1. Last Write Wins ì¶©ëŒ í•´ê²°**:
- ë™ì¼ ë…¸ë“œ ë™ì‹œ ìˆ˜ì • ì‹œ ë§ˆì§€ë§‰ ë³€ê²½ë§Œ ë°˜ì˜
- ì‹¤ì œ ë°œìƒ ë¹ˆë„: ë‚®ìŒ (ê°™ì€ ë…¸ë“œë¥¼ ë™ì‹œì— ë“œë˜ê·¸í•˜ëŠ” ê²½ìš° ë“œë¬¾)
- ê°œì„  ë°©í–¥: CRDT ì ìš© ì‹œ ì¶©ëŒ ì—†ì´ ë³‘í•© ê°€ëŠ¥í•˜ë‚˜ êµ¬í˜„ ë³µì¡ë„ ë†’ìŒ

**2. Canvas ì ‘ê·¼ì„±**:
- ìŠ¤í¬ë¦° ë¦¬ë” ë¯¸ì§€ì›
- ëŒ€ì•ˆ: ë…¸ë“œ ëª©ë¡ ë·° ì œê³µ (HTML ê¸°ë°˜)

**3. ì˜¤í”„ë¼ì¸ ì§€ì› ë¶€ì¡±**:
- WebSocket ëŠê¹€ ì‹œ í¸ì§‘ ë¶ˆê°€
- ê°œì„  ë°©í–¥: IndexedDB + Service Workerë¡œ ì˜¤í”„ë¼ì¸ í¸ì§‘ í›„ ë™ê¸°í™”

---

### ë¹„ì¦ˆë‹ˆìŠ¤ ì„íŒ©íŠ¸ (ì •ì„±ì )

**íŒ€ í˜‘ì—… íš¨ìœ¨ ê°œì„ **:
- ì‹¤ì‹œê°„ í”¼ë“œë°±ìœ¼ë¡œ ì•„ì´ë””ì–´ ë¸Œë ˆì¸ìŠ¤í† ë° ì†ë„ í–¥ìƒ
- í™”ë©´ ê³µìœ  ì—†ì´ ì›ê²© í˜‘ì—… ê°€ëŠ¥
- íšŒì˜ ì¤‘ ì¦‰ê°ì ì¸ êµ¬ì¡° ìˆ˜ì • ê°€ëŠ¥

**í”Œë«í¼ í†µí•©**:
- íŒ€ ê´€ë¦¬ ì‹œìŠ¤í…œ ë‚´ ë§ˆì¸ë“œë§µ ì œê³µìœ¼ë¡œ ì»¨í…ìŠ¤íŠ¸ ìŠ¤ìœ„ì¹­ ê°ì†Œ
- ë§ˆì¸ë“œë§µ â†’ ì¼ì •/TODO ì—°ë™ ê°€ëŠ¥ (í–¥í›„ í™•ì¥)

**ê¸°ìˆ ì  ì„±ê³¼**:
- Vanilla JavaScriptë¡œ ì‹¤ì‹œê°„ í˜‘ì—… êµ¬í˜„ (í”„ë ˆì„ì›Œí¬ ì˜ì¡´ ì—†ìŒ)
- Django Channels + Redis ì•„í‚¤í…ì²˜ í•™ìŠµ
- Canvas API ì¢Œí‘œ ë³€í™˜ ë° ë Œë”ë§ ìµœì í™” ê²½í—˜

---

## íŠ¸ëŸ¬ë¸”ìŠˆíŒ… ìš”ì•½

ì‹¤ì‹œê°„ ë§ˆì¸ë“œë§µ êµ¬í˜„ ì¤‘ ë°œìƒí•œ ì£¼ìš” ê¸°ìˆ ì  ë¬¸ì œì™€ í•´ê²° ê³¼ì •ì…ë‹ˆë‹¤. ìƒì„¸ ë‚´ìš©ì€ [íŠ¸ëŸ¬ë¸”ìŠˆíŒ… ë¬¸ì„œ](../troubleshooting.md)ë¥¼ ì°¸ê³ í•˜ì„¸ìš”.

### 1. WebSocket ì—°ê²° ì‹¤íŒ¨ (404 Not Found)

**ë¬¸ì œ**: `python manage.py runserver`ë¡œ ì‹¤í–‰ ì‹œ WebSocket ì—°ê²° ì‹¤íŒ¨

**ì›ì¸**: WSGI ì„œë²„ëŠ” WebSocket ë¯¸ì§€ì› (HTTPë§Œ ì§€ì›)

**í•´ê²°**: Daphne (ASGI ì„œë²„) ì‚¬ìš©
```bash
daphne -b 0.0.0.0 -p 8000 TeamMoa.asgi:application
```

**ìƒì„¸**: [íŠ¸ëŸ¬ë¸”ìŠˆíŒ… ë¬¸ì„œ #6](../troubleshooting.md#6-ğŸŸ¢-websocket-ì—°ê²°-ì‹¤íŒ¨-404-not-found)

---

### 2. Nginx WebSocket í”„ë¡ì‹œ ì‹¤íŒ¨ (502 Bad Gateway)

**ë¬¸ì œ**: HTTPS í™˜ê²½ì—ì„œ WebSocket ì—°ê²° ì‹¤íŒ¨

**ì›ì¸**: Nginx ê¸°ë³¸ ì„¤ì •ì€ HTTP/1.0 í”„ë¡ì‹œ (WebSocket Upgrade í—¤ë” ë¯¸ì „ë‹¬)

**í•´ê²°**: Nginx ì„¤ì •ì— Upgrade í—¤ë” ì¶”ê°€
```nginx
location /ws/ {
    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection "upgrade";
}
```

**ìƒì„¸**: [íŠ¸ëŸ¬ë¸”ìŠˆíŒ… ë¬¸ì„œ #7](../troubleshooting.md#7-ğŸŸ¡-nginx-websocket-í”„ë¡ì‹œ-ì‹¤íŒ¨-502-bad-gateway)

---

### 3. ì¢Œí‘œê³„ ë³€í™˜ ì˜¤ë¥˜

**ë¬¸ì œ**: ì¤Œ/íŒ¬ í›„ í´ë¦­ ìœ„ì¹˜ì™€ ì‹¤ì œ ë…¸ë“œ ìœ„ì¹˜ ë¶ˆì¼ì¹˜

**ì›ì¸**: í™”ë©´ ì¢Œí‘œ(í”½ì…€) â‰  ê°€ìƒ ìº”ë²„ìŠ¤ ì¢Œí‘œ

**í•´ê²°**: ì¢Œí‘œ ë³€í™˜ í•¨ìˆ˜ êµ¬í˜„
```javascript
function screenToCanvas(screenX, screenY) {
    return {
        x: (screenX - rect.left - offsetX) / zoom,
        y: (screenY - rect.top - offsetY) / zoom
    };
}
```

---

## ì°¸ê³  ìë£Œ

**Django Channels ê³µì‹ ë¬¸ì„œ**:
- [Channels ê°œìš”](https://channels.readthedocs.io/en/stable/)
- [Channel Layers](https://channels.readthedocs.io/en/stable/topics/channel_layers.html)

**WebSocket í”„ë¡œí† ì½œ**:
- [RFC 6455 - WebSocket Protocol](https://tools.ietf.org/html/rfc6455)
- [MDN - WebSocket API](https://developer.mozilla.org/en-US/docs/Web/API/WebSocket)

**Canvas API**:
- [MDN - Canvas Tutorial](https://developer.mozilla.org/en-US/docs/Web/API/Canvas_API/Tutorial)
- [HTML5 Canvas Performance](https://www.html5rocks.com/en/tutorials/canvas/performance/)

---

**ì‘ì„±ì¼**: 2025ë…„ 12ì›” 8ì¼
**ìµœì¢… ìˆ˜ì •**: 2025ë…„ 12ì›” 8ì¼ (ì‹¤ì¸¡ ì„±ëŠ¥ ì§€í‘œ ì¶”ê°€)
**ë²„ì „**: 2.1
**ë°ëª¨**: [https://teammoa.duckdns.org](https://teammoa.duckdns.org)
**ì½”ë“œ ìœ„ì¹˜**:
- Consumer: [`mindmaps/consumers.py`](../../../mindmaps/consumers.py)
- í´ë¼ì´ì–¸íŠ¸: [`static/js/pages/mindmap_detail.js`](../../../static/js/pages/mindmap_detail.js)
- Routing: [`mindmaps/routing.py`](../../../mindmaps/routing.py)
- ASGI ì„¤ì •: [`TeamMoa/asgi.py`](../../../TeamMoa/asgi.py)
