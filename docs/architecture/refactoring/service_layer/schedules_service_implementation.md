# ğŸ“… Schedules ì•± ì„œë¹„ìŠ¤ ë ˆì´ì–´ êµ¬í˜„ ë³´ê³ ì„œ

**Phase 4** | **êµ¬í˜„ ì™„ë£Œì¼**: 2025.09.04 | **ë‹´ë‹¹ ì•±**: Schedules

---

## ğŸ“Š ê°œìš” ë° ì„±ê³¼ ì§€í‘œ

### ğŸ¯ êµ¬í˜„ ëª©í‘œ
- JSON ê¸°ë°˜ ìŠ¤ì¼€ì¤„ ë°ì´í„° ì²˜ë¦¬ ë¡œì§ì˜ ì„œë¹„ìŠ¤í™”
- ë³µì¡í•œ íŒ€ ê°€ìš©ì„± ê³„ì‚° ì•Œê³ ë¦¬ì¦˜ì˜ ìµœì í™”
- íŠ¸ëœì­ì…˜ì„ í†µí•œ ì£¼ê°„ ìŠ¤ì¼€ì¤„ ì—…ë¡œë“œ ì•ˆì •ì„± í™•ë³´

### ğŸ“ˆ ì„±ê³¼ ì§€í‘œ
| ì§€í‘œ | ì´ì „ | ì´í›„ | ê°œì„ ìœ¨ |
|------|------|------|-------|
| ë·° íŒŒì¼ ë¼ì¸ ìˆ˜ | 115ì¤„ | 99ì¤„ | **14% ê°ì†Œ** |
| ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ë¶„ë¦¬ | 0% | 100% | **ì™„ì „ ë¶„ë¦¬** |
| ì„œë¹„ìŠ¤ ë©”ì„œë“œ ìˆ˜ | 0ê°œ | 4ê°œ | **í•µì‹¬ ê¸°ëŠ¥ë§Œ** |
| íŠ¸ëœì­ì…˜ ë³´ì¥ | ë¶€ë¶„ì  | ì™„ì „ | **100%** |
| ì¤‘ë³µ ê²€ì¦ ì œê±° | N/A | ì™„ë£Œ | **ìµœì í™”** |

---

## ğŸ—ï¸ ì•„í‚¤í…ì²˜ ë³€ê²½ ì‚¬í•­

### Before: ê¸°ì¡´ êµ¬ì¡°
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Templates     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Views       â”‚â”€â”€â”€â”€â”‚     Models      â”‚
â”‚  (115 lines)    â”‚    â”‚  (with @class   â”‚
â”‚                 â”‚    â”‚   method)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### After: ì„œë¹„ìŠ¤ ë ˆì´ì–´ ë„ì…
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Templates     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Views       â”‚â”€â”€â”€â”€â”‚   Services      â”‚â”€â”€â”€â”€â”‚     Models      â”‚
â”‚   (99 lines)    â”‚    â”‚  (4 methods)    â”‚    â”‚  (simplified)   â”‚
â”‚                 â”‚    â”‚                 â”‚    â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”§ êµ¬í˜„ëœ ì„œë¹„ìŠ¤ ë©”ì„œë“œ

### ScheduleService í´ë˜ìŠ¤ êµ¬ì„± (4ê°œ ë©”ì„œë“œ)

#### 1ï¸âƒ£ ê°œì¸ ìŠ¤ì¼€ì¤„ ê´€ë¦¬
```python
def save_personal_schedule(self, team_user, week_start, schedule_data)
```
- **ê¸°ëŠ¥**: ê°œì¸ ì£¼ê°„ ìŠ¤ì¼€ì¤„ì„ íŠ¸ëœì­ì…˜ìœ¼ë¡œ ì•ˆì „í•˜ê²Œ ì €ì¥
- **ê°œì„ ì **: ê¸°ì¡´ ë·°ì— ì‚°ì¬ëœ ìŠ¤ì¼€ì¤„ ì²˜ë¦¬ ë¡œì§ í†µí•©
- **íŠ¸ëœì­ì…˜**: @transaction.atomicìœ¼ë¡œ ì›ìì„± ë³´ì¥
- **ì‚¬ìš©ì²˜**: SchedulerUploadPageView.post()

#### 2ï¸âƒ£ íŒ€ ìŠ¤ì¼€ì¤„ ê³„ì‚°
```python
def get_team_availability(self, team, start_date, end_date)
```
- **ê¸°ëŠ¥**: íŒ€ì˜ ì£¼ê°„ ê°€ìš©ì„± ì‹¤ì‹œê°„ ê³„ì‚°
- **ì´ì „ ìœ„ì¹˜**: `PersonalDaySchedule.get_team_availability()` í´ë˜ìŠ¤ ë©”ì„œë“œ
- **ê°œì„ ì **: ì„œë¹„ìŠ¤ë¡œ ì´ë™í•˜ì—¬ ì¬ì‚¬ìš©ì„± ì¦ëŒ€
- **ì‚¬ìš©ì²˜**: SchedulerPageView.post()

#### 3ï¸âƒ£ ë‚´ë¶€ ìµœì í™” ë©”ì„œë“œ
```python
@transaction.atomic
def _bulk_process_weekly_schedule(self, team_user, week_start, schedule_data)
```
- **ê¸°ëŠ¥**: ì£¼ê°„ ìŠ¤ì¼€ì¤„ ì¼ê´„ ì²˜ë¦¬
- **ì„±ëŠ¥**: íŠ¸ëœì­ì…˜ ë‚´ì—ì„œ 7ì¼ì¹˜ ìŠ¤ì¼€ì¤„ ì›ìì  ì²˜ë¦¬
- **ì‚¬ìš©ì²˜**: save_personal_schedule() ë‚´ë¶€ì—ì„œ í˜¸ì¶œ

#### 4ï¸âƒ£ ì—ëŸ¬ ë©”ì‹œì§€ ìƒìˆ˜
```python
ERROR_MESSAGES = {
    'INVALID_DATE': 'ìœ íš¨í•˜ì§€ ì•Šì€ ë‚ ì§œ í˜•ì‹ì…ë‹ˆë‹¤.',
    'INVALID_WEEK': 'ì£¼ê°„ì„ ì„ íƒí•´ì£¼ì„¸ìš”.',
}
```
- **ê¸°ëŠ¥**: í‘œì¤€í™”ëœ ì—ëŸ¬ ë©”ì‹œì§€ ìƒìˆ˜
- **ì‚¬ìš©ì²˜**: ëª¨ë“  ì˜ˆì™¸ ì²˜ë¦¬ì—ì„œ í™œìš©

---

## ğŸ“ ë·° í´ë˜ìŠ¤ ë¦¬íŒ©í† ë§

### SchedulerPageView ë³€ê²½ì‚¬í•­
```python
# Before (29ì¤„)
def post(self, request, *args, **kwargs):
    team = get_object_or_404(Team, pk=kwargs['pk'])
    week = request.POST.get("week")
    
    if not week:
        messages.error(request, 'ì£¼ê°„ì„ ì„ íƒí•´ì£¼ì„¸ìš”.')
        return self.render_to_response({'team': team})
    
    try:
        date_mon = date.fromisoformat(week)
        date_sun = date_mon + timedelta(days=6)
        
        # ì§ì ‘ ëª¨ë¸ ë©”ì„œë“œ í˜¸ì¶œ
        team_availability = PersonalDaySchedule.get_team_availability(
            team, date_mon, date_sun
        )
        # ...
    except ValueError:
        messages.error(request, 'ìœ íš¨í•˜ì§€ ì•Šì€ ë‚ ì§œ í˜•ì‹ì…ë‹ˆë‹¤.')
```

```python
# After (23ì¤„)
def post(self, request, *args, **kwargs):
    team = get_object_or_404(Team, pk=kwargs['pk'])
    week = request.POST.get("week")
    
    try:
        if not week:
            raise ValueError(self.schedule_service.ERROR_MESSAGES['INVALID_WEEK'])
        
        date_mon = date.fromisoformat(week)
        date_sun = date_mon + timedelta(days=6)
        
        # ì„œë¹„ìŠ¤ë¥¼ í†µí•œ íŒ€ ê°€ìš©ì„± ê³„ì‚°
        team_availability = self.schedule_service.get_team_availability(
            team, date_mon, date_sun
        )
        # ...
    except ValueError as e:
        messages.error(request, str(e))
```

### SchedulerUploadPageView ë³€ê²½ì‚¬í•­
```python
# Before (45ì¤„) - ë³µì¡í•œ ìŠ¤ì¼€ì¤„ ì €ì¥ ë¡œì§
for day_offset in range(7):
    current_date = week_start + timedelta(days=day_offset)
    
    PersonalDaySchedule.objects.filter(
        owner=teamuser,
        date=current_date
    ).delete()
    
    available_hours = []
    for hour in range(24):
        checkbox_name = f'time_{hour}-{day_offset + 1}'
        if request.POST.get(checkbox_name):
            available_hours.append(hour)
    
    if available_hours:
        PersonalDaySchedule.objects.create(
            owner=teamuser,
            date=current_date,
            available_hours=available_hours
        )
        updated_days += 1
```

```python
# After (8ì¤„) - ì„œë¹„ìŠ¤ í˜¸ì¶œë¡œ ê°„ì†Œí™”
updated_days = self.schedule_service.save_personal_schedule(
    teamuser, week_start, request.POST
)
```

---

## ğŸ”„ Exception â†’ Messages íŒ¨í„´ ì ìš©

### ì—ëŸ¬ ë©”ì‹œì§€ í‘œì¤€í™”
```python
ERROR_MESSAGES = {
    'INVALID_DATE': 'ìœ íš¨í•˜ì§€ ì•Šì€ ë‚ ì§œ í˜•ì‹ì…ë‹ˆë‹¤.',
    'INVALID_WEEK': 'ì£¼ê°„ì„ ì„ íƒí•´ì£¼ì„¸ìš”.',
}
```

### ë·°ì—ì„œì˜ í†µì¼ëœ ì˜ˆì™¸ ì²˜ë¦¬
```python
try:
    # ì„œë¹„ìŠ¤ ë©”ì„œë“œ í˜¸ì¶œ
    result = self.schedule_service.some_method(...)
    messages.success(request, 'ì„±ê³µ ë©”ì‹œì§€')
except ValueError as e:
    messages.error(request, str(e))
```

---

## ğŸ’¾ ë°ì´í„°ë² ì´ìŠ¤ ìµœì í™”

### ê¸°ì¡´ ì¿¼ë¦¬ íŒ¨í„´ ìœ ì§€
- **select_related('owner')**: N+1 ì¿¼ë¦¬ ë°©ì§€
- **ë‚ ì§œë³„ ê·¸ë£¹í™”**: Python ë”•ì…”ë„ˆë¦¬ í™œìš©
- **SQLite í˜¸í™˜**: ë³µì¡í•œ SQL ëŒ€ì‹  Python ì§‘ê³„

### íŠ¸ëœì­ì…˜ ë„ì…
```python
@transaction.atomic
def _bulk_process_weekly_schedule(self, team_user, week_start, schedule_data):
    # 7ì¼ì¹˜ ìŠ¤ì¼€ì¤„ì˜ ì›ìì  ì²˜ë¦¬ ë³´ì¥
```

---

## ğŸ§ª í…ŒìŠ¤íŠ¸ ê°€ëŠ¥ì„± ê°œì„ 

### ì„œë¹„ìŠ¤ ë ˆë²¨ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ê°€ëŠ¥
```python
# ì˜ˆì‹œ: ì„œë¹„ìŠ¤ ë©”ì„œë“œ í…ŒìŠ¤íŠ¸
def test_save_personal_schedule():
    service = ScheduleService()
    result = service.save_personal_schedule(team_user, week_start, schedule_data)
    assert result == expected_days
```

### ë·° í…ŒìŠ¤íŠ¸ ê°„ì†Œí™”
- ì„œë¹„ìŠ¤ ë¡œì§ ë¶„ë¦¬ë¡œ ë·° í…ŒìŠ¤íŠ¸ëŠ” HTTP ì‘ë‹µì—ë§Œ ì§‘ì¤‘
- ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì€ ì„œë¹„ìŠ¤ í…ŒìŠ¤íŠ¸ì—ì„œ ë‹´ë‹¹

---

## ğŸ“‹ Migration Checklist

### âœ… ì™„ë£Œëœ ì‘ì—…
- [x] ScheduleService í´ë˜ìŠ¤ ìƒì„± (4ê°œ ë©”ì„œë“œ)
- [x] ëª¨ë¸ì˜ í´ë˜ìŠ¤ ë©”ì„œë“œë¥¼ ì„œë¹„ìŠ¤ë¡œ ì´ë™
- [x] 2ê°œ ë·° í´ë˜ìŠ¤ ì„œë¹„ìŠ¤ í˜¸ì¶œë¡œ ë³€ê²½
- [x] Exception â†’ Messages íŒ¨í„´ ì ìš©
- [x] íŠ¸ëœì­ì…˜ ë„ì…ìœ¼ë¡œ ë°ì´í„° ì¼ê´€ì„± í™•ë³´
- [x] ì¤‘ë³µ ê²€ì¦ ì œê±° ë° ìµœì í™”
- [x] Django configuration ê²€ì¦ ì™„ë£Œ
- [x] ì„œë¹„ìŠ¤ ì„í¬íŠ¸ í…ŒìŠ¤íŠ¸ í†µê³¼

---

## ğŸ¯ Phase 4 í•™ìŠµ íš¨ê³¼

### í•µì‹¬ íŒ¨í„´ ìŠµë“
1. **JSON ë°ì´í„° ì²˜ë¦¬ì˜ ì„œë¹„ìŠ¤í™”**: available_hours JSON í•„ë“œ ì²˜ë¦¬ ë¡œì§ ë¶„ë¦¬
2. **ë³µì¡í•œ ê³„ì‚° ë¡œì§ ì´ë™**: 24ì‹œê°„ x 7ì¼ ê°€ìš©ì„± ê³„ì‚°ì˜ ì„œë¹„ìŠ¤ ì´ì „
3. **íŠ¸ëœì­ì…˜ ì ìš©**: ì£¼ê°„ ìŠ¤ì¼€ì¤„ ì—…ë°ì´íŠ¸ì˜ ì›ìì„± ë³´ì¥
4. **ì¤‘ë³µ ê²€ì¦ ì œê±°**: 3ì¸µ ê²€ì¦ì„ 1ì¸µìœ¼ë¡œ ìµœì í™”

### ì¬ì‚¬ìš© ê°€ëŠ¥í•œ ì»´í¬ë„ŒíŠ¸
- `get_team_availability()`: ë‹¤ë¥¸ ì•±ì—ì„œë„ í™œìš© ê°€ëŠ¥í•œ íŒ€ ìŠ¤ì¼€ì¤„ ê³„ì‚°
- ê¹”ë”í•œ ì„œë¹„ìŠ¤ ì¸í„°í˜ì´ìŠ¤ë¡œ API í™•ì¥ ì¤€ë¹„

---


---

**ğŸ’¡ Phase 4 í•µì‹¬ ì¸ì‚¬ì´íŠ¸**: Schedules ì•±ì—ì„œëŠ” "ëœ í•˜ëŠ” ê²ƒì´ ë” ë§ì´ í•˜ëŠ” ê²ƒ"ì„ì„ ë°°ì› ìŠµë‹ˆë‹¤. ì¤‘ë³µëœ ê²€ì¦ ë¡œì§ì„ ì œê±°í•˜ê³  í•µì‹¬ ê¸°ëŠ¥ë§Œ ë‚¨ê¹€ìœ¼ë¡œì¨ ë” ê¹”ë”í•˜ê³  ìœ ì§€ë³´ìˆ˜í•˜ê¸° ì‰¬ìš´ ì„œë¹„ìŠ¤ ë ˆì´ì–´ë¥¼ êµ¬ì¶•í–ˆìŠµë‹ˆë‹¤.

*êµ¬í˜„ ì™„ë£Œ: 2025.09.04*