{% extends "base_app.html" %} {% load static humanize %}

{% block mobileView %}
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/base/variables.css' %}" type="text/css" />
<link rel="stylesheet" href="{% static 'css/pages/shares/post_list.css' %}" type="text/css" />
{% endblock %}

{% block contents %}
{% comment %} Light theme styles loaded in base_app.html {% endcomment %}

<section class="sharessection">
  <div class="shares-header">
    <div>
      <h1>공유 게시판</h1>
      {% if q %}
      <p class="post-list__search-result">
        <i class="fas fa-search"></i>&nbsp;'{{ q }}' 검색 결과입니다.
      </p>
      {% endif %}
    </div>
    {% if team_id %}
    <a href="{% url 'shares:post_write' team_id %}" class="write-btn">
      글쓰기
    </a>
    {% endif %}
  </div>
  
  <div class="search-section">
    <form action="" method="GET" class="search-form">
      <select class="search-select" name="type">
        <option value="all">전체</option>
        <option value="title_content">제목+내용</option>
        <option value="title">제목</option>
        <option value="content">내용</option>
        <option value="writer">작성자</option>
      </select>
      <input 
        type="text" 
        name="q" 
        value="{{ q }}" 
        class="search-input"
        placeholder="검색어를 입력해주세요."
      />
      <button type="submit" class="search-btn">검색</button>
    </form>
  </div>
  {% if post_fixed or post_list %}
  <div class="posts-grid">
    {% if not q and post_fixed %}
    {% for post in post_fixed %}
    <div class="post-card fixed" onclick="location.href='/shares/{{ team.id }}/detail/{{ post.id }}'">
      <div class="post-header">
        <h3 class="post-title">
          <i class="fas fa-bullhorn fixed-icon"></i>
          {{ post.title|truncatechars:50 }}
        </h3>
      </div>
      <div class="post-meta">
        <span class="post-author">{{ post.writer }}</span>
        <span class="post-date">{{ post.registered_date|date:'Y. m. d' }}</span>
      </div>
    </div>
    {% endfor %}
    {% endif %}
    
    {% if post_list %}
    {% for post in post_list %}
    <div class="post-card" onclick="location.href='/shares/{{ team.id }}/detail/{{ post.id }}'">
      <div class="post-header">
        <h3 class="post-title">{{ post.title|truncatechars:50 }}</h3>
      </div>
      <div class="post-meta">
        <span class="post-author">{{ post.writer.nickname }}</span>
        <span class="post-date">{{ post.registered_date|date:'Y. m. d' }}</span>
      </div>
    </div>
    {% endfor %}
    {% endif %}
  </div>
  {% else %}
  <div class="posts-empty">
    {% if q %}
    <h3><i class="fas fa-info-circle"></i> 검색 결과가 없습니다</h3>
    <p>'{{ q }}'와(과) 일치하는 게시글을 찾을 수 없습니다.</p>
    {% else %}
    <h3><i class="fas fa-info-circle"></i> 작성된 게시글이 없습니다</h3>
    <p>첫 번째 게시글을 작성해보세요!</p>
    {% endif %}
  </div>
  {% endif %}
  {% if is_paginated %}
  <div class="pagination-wrapper">
    <div class="pagination">
      {% if page_obj.has_previous %}
      <a class="page-link" href="?type={{ type }}&q={{ q }}&page={{ page_obj.previous_page_number }}">이전</a>
      {% else %}
      <span class="page-link disabled">이전</span>
      {% endif %}
      
      {% for page in page_range %}
      <a class="page-link {% if page == page_obj.number %}active{% endif %}" 
         href="?type={{ type }}&q={{ q }}&page={{ page }}">{{ page }}</a>
      {% endfor %}
      
      {% if page_obj.has_next %}
      <a class="page-link" href="?type={{ type }}&q={{ q }}&page={{ page_obj.next_page_number }}">다음</a>
      {% else %}
      <span class="page-link disabled">다음</span>
      {% endif %}
    </div>
  </div>
  {% endif %}
</section>

<script type="text/javascript">
  target = window.location.search.split("&")[0].split("=")[1];
  var type = document.getElementsByTagName("option");
  for (var i = 0; i < 5; i++) {
    if (type[i].value === target) {
      type[i].setAttribute("selected", "selected");
    }
  }
</script>
{% endblock %}
